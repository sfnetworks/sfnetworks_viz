---
title: "ideas"
author: "Lorena Abad"
date: "6/16/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Ideas for ggraph

### Layout

Defines how nodes are placed on the plot, so where to put each node. 

We can first try with getting x and y coordinates of the geometry list column

```{r, eval = F}
library(ggraph)
library(tidygraph)
library(sfnetworks)
library(sf)
library(ggplot2)
graph_layout = roxel %>% 
  as_sfnetwork(directed = F) %>% 
  convert(to_spatial_coordinates)

graph_layout

sf = ggraph:::layout_tbl_graph_manual(
  graph_layout, X, Y, circular = F
)
layout <- create_layout(graph, layout = 'sf')
layout
```

### Nodes and edges
wrap around geom_sf / ggproto layer GeomSf

- geom_edges_spatial
- geom_edges_straight
- geom_nodes_spatial


Integration between ggraph and spatial ggplot2
No need to escape the network
ggraph would accept an object of class `sfnetwork`

```{r}
library(sfnetworks)
library(tidygraph)
library(sf)
library(ggraph)
graph = roxel %>% 
  as_sfnetwork(directed = F) %>% convert(to_components)
ggraph(graph, 'focus', focus = node_is_center()) +
  ggforce::geom_circle(
    aes(x0 = 0, y0 = 0, r = r), 
    data.frame(r = 1:20), colour = 'grey'
  ) +
  geom_edge_link() +
  geom_node_point(color = 'orangered') +
  coord_fixed() +
  theme(
    panel.background = element_rect(fill = "transparent"),
    plot.background = element_rect(fill = "transparent", color = NA)
  )
```

```{r}
nodes = graph %>% activate(nodes) %>% st_as_sf()
ggraph(graph) +
  geom_sf(data = nodes) 

geom_edge_spatial = function(x) {
  edges = st_as_sf(x, 'edges')
  geom_sf(data = edges)
}

library(ggraph)
ggraph(graph) +
  geom_edge_spatial(graph)
```

## Final thoughts:

- We can create a layout based on sf coordinates
    + We should make sure that CRS is respected and that there is no distorsion
    + layout_tbl_graph_manual which is an internal function
    
- We can create a geom_edge_spatial or something similar that will take the geometry of the LINESTRING 
- Maybe wrapped around geom_sf
- Or taking a look at the draw_panel, sf::st_as_grob


- We can create any representation of edges (spatially implicit) and we would add the spatially explicit


### New opportunities

- explore 3D representation, maybe with `rayshader` 
  + this can take a look into st_zm coordinates
- maybe look into interactive plotting: `mapview`
  
```{r}
library(sfnetworks)
library(ggplot2)
library(sf)
library(plotly)

roxel

g = ggplot() +
  geom_sf(data = roxel, aes(color = type))

ggplotly(g)
```

